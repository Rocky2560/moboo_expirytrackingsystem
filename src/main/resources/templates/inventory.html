<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory - Moboo Inventory</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Same CSS as before, plus additional styles for inventory section */
        .adjustment-modal {
            max-width: 600px;
        }
        .health-indicator {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin: 0 auto 10px;
        }
        .health-good { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .health-warning { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); }
        .health-critical { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }
    </style>
</head>
<body class="bg-light">
<!-- Include sidebar and navbar similar to dashboard template -->

<div class="main-content">
    <!-- Navbar --> <nav class="sidebar d-none d-md-block">
    <div class="p-4">
        <div class="d-flex align-items-center mb-4">
            <div class="bg-primary text-white p-2 rounded-circle me-3">
                <i class="fas fa-mug-hot fa-lg"></i>
            </div>
            <div>
                <h5 class="mb-0 navbar-brand">Moboo Inventory</h5>
                <small class="text-muted" th:text="${session.userRole}">Role</small>
            </div>
        </div>

        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link active" href="#">
                    <i class="fas fa-home me-2"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/inventory}">
                    <i class="fas fa-box me-2"></i> Inventory
                </a>
            </li>
            <li class="nav-item" th:if="${session.userRole == 'ADMIN'}">
                <a class="nav-link" href="#">
                    <i class="fas fa-store me-2"></i> Franchises
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="fas fa-exclamation-triangle me-2"></i> Alerts
                </a>
            </li>
        </ul>

        <div class="mt-4">
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="btn btn-outline-danger w-100">
                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                </button>
            </form>
        </div>
    </div>
</nav>

    <!--    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">-->
<!--        <div class="container-fluid">-->
<!--            <h4>Inventory Management</h4>-->
<!--            <div class="d-flex">-->
<!--                <form th:action="@{/logout}" method="post" class="ms-3">-->
<!--                    <button type="submit" class="btn btn-outline-danger btn-sm">-->
<!--                        <i class="fas fa-sign-out-alt"></i> Logout-->
<!--                    </button>-->
<!--                </form>-->
<!--            </div>-->
<!--        </div>-->
<!--    </nav>-->

    <div class="container-fluid py-4">
        <!-- Stats Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="card stat-card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="card-icon bg-primary text-white">
                            <i class="fas fa-box fa-lg"></i>
                        </div>
                        <h6 class="card-title mb-0">Total Items</h6>
                        <h3 class="card-text mb-0" th:text="${totalItems}">24</h3>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card stat-card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="card-icon bg-warning text-white">
                            <i class="fas fa-exclamation-triangle fa-lg"></i>
                        </div>
                        <h6 class="card-title mb-0">Low Stock</h6>
                        <h3 class="card-text mb-0" th:text="${lowStockCount}">8</h3>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card stat-card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="card-icon bg-orange text-white">
                            <i class="fas fa-clock fa-lg"></i>
                        </div>
                        <h6 class="card-title mb-0">Expiring Soon</h6>
                        <h3 class="card-text mb-0" th:text="${expiringSoonCount}">5</h3>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card stat-card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="card-icon bg-danger text-white">
                            <i class="fas fa-calendar-times fa-lg"></i>
                        </div>
                        <h6 class="card-title mb-0">Expired</h6>
                        <h3 class="card-text mb-0" th:text="${expiredCount}">3</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons and Filters -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="d-flex flex-wrap gap-3">
                    <button class="btn btn-gradient" data-bs-toggle="modal" data-bs-target="#addItemModal">
                        <i class="fas fa-plus me-2"></i> Add Item
                    </button>

                    <div class="input-group" style="width: 300px;">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control"
                               th:value="${searchTerm}"
                               name="search"
                               placeholder="Search items...">
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <select class="form-select" name="category" onchange="this.form.submit()">
                    <option value="All" th:selected="${selectedCategory == 'All'}">All Categories</option>
                    <option th:each="cat : ${categories}"
                            th:value="${cat}"
                            th:text="${cat}"
                            th:selected="${selectedCategory == cat}">Category</option>
                </select>
            </div>
        </div>

        <!-- Inventory Table -->
        <div class="row">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th>Item Name</th>
                                    <th>Category</th>
                                    <th>Count</th>
                                    <th>Expiry Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="item : ${inventoryItems}">
                                    <td th:text="${item.name}">Tapioca Pearls</td>
                                    <td th:text="${item.category}">Ingredients</td>
                                    <td>
                                                <span th:text="${item.count}"
                                                      th:class="${item.count < 10 ? 'text-warning fw-bold' : 'text-dark'}">25</span>
                                    </td>
                                    <td th:text="${#temporals.format(item.expiryDate, 'yyyy-MM-dd')}">2024-01-15</td>
                                    <td>
                                        <span th:if="${item.status == 'EXPIRED'}" class="badge bg-danger">Expired</span>
                                        <span th:if="${item.status == 'EXPIRING_SOON'}" class="badge bg-warning text-dark">Expiring Soon</span>
                                        <span th:if="${item.status == 'LOW_STOCK'}" class="badge bg-orange">Low Stock</span>
                                        <span th:if="${item.status == 'GOOD'}" class="badge bg-success">Good</span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary"
                                                data-bs-toggle="modal"
                                                th:data-bs-target="'#adjustModal' + ${item.id}">
                                            <i class="fas fa-edit"></i> Adjust
                                        </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Item Modal -->
<div class="modal fade" id="addItemModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form th:action="@{/inventory/add}" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Item Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select class="form-select" name="category" required>
                            <option value="Ingredients">Ingredients</option>
                            <option value="Syrups">Syrups</option>
                            <option value="Fruits">Fruits</option>
                            <option value="Packaging">Packaging</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Count</label>
                        <input type="number" class="form-control" name="count" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Expiry Date</label>
                        <input type="date" class="form-control" name="expiryDate" required>
                    </div>
                    <div class="mb-3" th:if="${userRole == 'ADMIN'}">
                        <label class="form-label">Franchise</label>
                        <select class="form-select" name="franchiseId" required>
                            <option th:each="franchise : ${franchises}"
                                    th:value="${franchise.id}"
                                    th:text="${franchise.name}">Franchise</option>
                        </select>
                    </div>
                    <input type="hidden" name="franchiseId" th:if="${userRole == 'FRANCHISE'}"
                           th:value="${session.franchiseId}">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-gradient">Add Item</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Adjust Item Modal (dynamically generated for each item) -->
<div th:each="item : ${inventoryItems}" class="modal fade" th:id="'adjustModal' + ${item.id}" tabindex="-1">
    <div class="modal-dialog adjustment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Adjust Stock: <span th:text="${item.name}">Item Name</span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form th:action="@{/inventory/adjust}" method="post">
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <div class="health-indicator"
                             th:classappend="${item.count == 0 ? 'health-critical' : (item.count < 10 ? 'health-warning' : 'health-good')}">
                            <span th:text="${item.count}">25</span>
                        </div>
                        <p class="text-muted">Current Stock</p>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">New Count</label>
                        <input type="number" class="form-control" name="newCount"
                               th:value="${item.count}" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Reason for Adjustment</label>
                        <select class="form-select" name="reason" required>
                            <option value="Stock Count">Stock Count</option>
                            <option value="Theft/Damage">Theft/Damage</option>
                            <option value="Waste">Waste</option>
                            <option value="Delivery Received">Delivery Received</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <input type="hidden" name="itemId" th:value="${item.id}">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-gradient">Update Stock</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>